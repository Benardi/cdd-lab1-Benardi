---
title: "EDA on IMDB Series"
subtitle: 'Is there connection between season length, number of votes, ratings and consensus?'
author: "José Benardi de Souza Nunes"
output:
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

<br></br>

## Introduction

### Analyzed Dataset

> Exploratory Data Analysis on data from [IMDB](https://www.imdb.com/)  about TV series and Streaming. The original data and variables come from [this repository](https://github.com/nazareno/imdb-series) . There we have explained how the data was retrieved and the meaning of each variable.

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

```{r}
episodes <- read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character())) 
episodes %>% 
    glimpse()
```

### Small explanation about employed estimators

<br></br>
    
```
- Mean: the sum of the values of the elements of a group divided by the number of elements in that group.
- Mode: the most frequent element inside a group of values.
- Median: the value inside a group of sorted values that divides them into 50% bigger and 50% smaller.
- IQR: in a group of sorted values contains the 50% central values, e.g. if we had a sequence going from 1 to 100 the IQR would go from 25 to 75 (the 50 central values).
```

```{r}
x<-rnorm(100000,mean=10, sd=2);
qqnorm(x, pch = 1, frame = FALSE);
qqline(x, col = "red", lwd = 2);
```

The Q-Q Plot (quantile-quantile plot) will be employed to describe metrics used in this analysis. The Q-Q Plot of a well behaved distribution (gaussian, symetric..) is well aligned as in the example chart.  

***

## Data Overview

### Number of votes of a certain episode

```{r}
episodes %>%
    group_by(episode) %>%
    filter(user_votes != max(user_votes)) %>%
    ggplot(aes(user_votes,y=..density..)) +
    geom_histogram(binwidth = 50,
                   fill="grey",
                   color="black") +
    scale_x_continuous(breaks=seq(0,9750,250)) +
    labs(x = "User votes",
         y = "Frequency density") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

* We have a obvious mode between 0 and 250 votes.
* The highest values are very far way from the mode, this impacts the distribution mean and median making them higher than the mode. 
* The are no values that violate the nature of the quantity (e.g. negative values), and would therefore invalidate our analysis. 

<br></br>

Let's look at the _10 most rated episodes_:


```{r}
episodes %>%
    select(series_name,episode,user_votes) %>%
    top_n(10, user_votes) %>% 
    arrange(desc(user_votes))
```

The top 3 most voted episodes have a sensibly higher number of votes than the rest, particularly the most voted episode of all has 40.000 more votes than the second place.

```{r}
episodes %>% 
    group_by(episode) %>%
    ggplot(aes(sample=user_votes)) + 
        stat_qq()
```

* The quantile-quantile plot clearly shows the leap around the highest values, which are very far away from the rest of the distribution.

### Avaliação dos usuários

```{r}
episodes %>% 
    group_by(episode) %>%
    ggplot(aes(user_rating, ..density..)) +
    geom_histogram(binwidth = 0.1,
                   fill="grey",
                   color="black") +
    labs(x = "Episode Rating",
         y = "Frequency density") +
        scale_x_continuous(breaks=seq(0,10,1)) 
```

* The most frequent rating is clearly around 8.
* The distribution is *relatively* well behaved (symetric), there's however the occurrence of lower ratings (between 3 and 6). 
* The are no values that violate the nature of the quantity (e.g. negative values), and would therefore invalidate our analysis.    

```{r}
episodes %>% 
    group_by(episode) %>%
    ggplot(aes(sample=user_rating)) + 
        stat_qq() 
```

* The lower ratings previously mentioned affect the curvature and prove that the distribution of episodes ratings do not compose a symetric distribution (well behaved).

### Tamanho das temporadas

```{r}
sumario_n_seasons <- episodes %>%
    group_by(series_name, season) %>%
    summarise(season_size = n()) 

episodes <- left_join(episodes, sumario_n_seasons, by= c("series_name","season")) 

episodes %>% 
    select(series_name, season, season_size) %>% 
    unique() %>%
    sample_n(10)
```

```{r}
episodes %>%
    select(series_name,
           season,
           season_size) %>% 
    unique() %>%
    ggplot(aes(season_size,..density..)) + 
    geom_density(aes(y= 2.5 *..density..),
             color="lightpink") +
    geom_histogram(binwidth = 1, 
                   fill="grey",
                   color="black") +
    scale_x_continuous(breaks=seq(0,120,5)) +
    labs(y = "Frequency density", x = "Season length")

```

* The most frequent season length is around 10 and 20 episodes (Two modes ou bimodal).
* Few seasons are curiously long. 
* The are no values that violate the nature of the quantity (e.g. negative values), and would therefore invalidate our analysis.

<br></br>

Let's observe the seasons that **called our attention** for being too long:

```{r}
episodes %>%
    select(series_name,
           season,
           season_size) %>% 
    unique() %>% 
    top_n(10, season_size) %>% 
    arrange(desc(season_size))
```

The series *Yu Yu Hakusho* which has 4 seasons is being wrongly classified as a single whole season. For this reason, we shall not include the series *Yu Yu Hakusho* in our analysis regarding seasons.

```{r}
episodes %>% 
    filter(series_name != "Yu Yu Hakusho") %>%
    ggplot(aes(sample=season_size)) +
    stat_qq() 
```

* In the Q-Q plot there's a step (descontinuity), which matches the two modes on the respective histogram (two most frequent values).  



### Tamanho mediano da temporada de uma série

Para representar o tamanho geral da temporada de uma série, faremos uso da mediana. Entre os argumentos para obtar pela mediana ao invés de outras medidas como uma média ou média aparada listamos:

* A mediana torna menos recorrente o aparecimento de valores não inteiros (e.g. 4,6) que não fariam sentido para algo como o tamanho de uma série.
* A mediana é uma medida robusta, ou seja ela é menos facilmente afetada por valores extremos.

```{r}
summary_season_size <- episodes %>%
    group_by(series_name) %>%
    summarize(median_season_size = median(season_size)) %>%
    ungroup()

episodes <- left_join(episodes, summary_season_size,
                      by = c("series_name")) 

episodes %>% 
    filter(series_name != "Yu Yu Hakusho") %>%
    select(series_name,
           season_ep,
           median_season_size) %>%
    sample_n(10)
```

```{r}
episodes %>%
    filter(series_name != "Yu Yu Hakusho") %>%
    select(series_name, median_season_size) %>% 
    unique() %>%
    ggplot(aes(median_season_size,..density..)) +
    geom_density(aes(y= 2.5 *..density..),
                 color="red") +
    geom_histogram(binwidth = 1,
                   fill="grey",
                   color="black") +
    scale_x_continuous(breaks=seq(0,120,5)) +
        labs(x = "Tamanho mediano de temporada",
         y = "Densidade de frequência")

```

* O tamanho mediano da temporada se comporta semelhantemente ao tamanho de uma temporada.

```{r}
episodes %>%
    filter(series_name != "Yu Yu Hakusho") %>%
    select(series_name, median_season_size) %>% 
    unique() %>%
    ggplot(aes(sample=median_season_size)) + 
        stat_qq() 
```

* O tamanho mediano da temporada mais uma vez se comporta semelhantemente ao tamanho de uma temporada.

### Consenso em relação à nota de um episódio

Geramos a informação de consenso como o máximo entre as frequências relativas das possíveis notas  de 1 até 10 (r1 até r10), pois quanto mais elevado esse máximo maior a proporção de pessoas cujas notas coincidiram. 

```{r}
episodes <- episodes %>%
    group_by(series_name,episode) %>%
    mutate(consensus = max(r1,r2,r3,r4,r5,r6,r7,r8,r9,r10)) %>%
    ungroup()

episodes %>% 
    select(episode,consensus) %>%
    sample_n(10)
```

```{r}
episodes %>%
    select(series_name, consensus) %>% 
    unique() %>%
    ggplot(aes(consensus,..density..)) +
    geom_histogram(binwidth = 0.01,
                   fill="grey",
                   color="black") +
    scale_x_continuous(breaks=seq(0,1,0.125)) +
    labs(x = "Grau de consenso",
         y = "Densidade de frequência")

```

* A moda do grau de consenso está em torno de 0.3125, ou seja o mais frequente foi 31,25% das pessoas darem a mesma nota ao episódio.   
* Valores mais altos indo até em torno de 87,50% de consenso ocorrem.  
* Não existem valores que fujam ao domínio da grandeza (e.g. valores negativos) e que por isso invalidem nossa análise.         

```{r}
episodes %>%
    select(series_name, consensus) %>% 
    unique() %>%
    ggplot(aes(sample=consensus)) + 
        stat_qq() 
```

* Os valores altos e distantes da moda afetam a curvatura do gráfico de quantis, o qual atesta que a distribuição do grau de consenso não é bem comportada (simétrica).

***

## Temporadas mais curtas são mais bem avaliadas?

```{r}
episodes %>%
    filter(series_name != "Yu Yu Hakusho") %>%
    ggplot(aes(user_rating,
               season_size)) +
    geom_point(alpha=0.08,
               color="#ff6666") +
        scale_y_continuous(breaks=seq(0,100,5)) +
        scale_x_continuous(breaks=seq(0,10,1)) +
          labs(x = "Nota dada pelo usuário",
         y = "Tamanho da temporada")
```

Temporadas entre 1 e 25 episódios são visivelmente dispersas, com valores indo de 3 até 10,  já que a maior parte das ocorrências está nessa faixa. Apesar disso também **é visível que a maior parcela das ocorrência gira em torno da nota 8 (mais ou menos entre 7 e 9)**. Esse padrão em geral se mantém a despeito do tamanho da temporada e *está em acordo com a moda da distribuição das notas que é 8*. 

Existe porém duas exceções:

 * Para as temporadas de aproximadamente 40 episódios existe uma notável queda das notas
 * Nas temporas acima dos 40 episódios parece haver um aumento da nota dada pelos usuários, mas sua relevância não parece clara ou forte.


```{r}
episodes %>%
    filter(series_name != "Yu Yu Hakusho") %>%
    ggplot(aes(season_size, 
               user_rating, 
               group=season_size)) +
    geom_boxplot(position = "dodge",
                 outlier.shape = NA,
                 color="#ff6666") +
    scale_x_continuous(breaks=seq(0,90,5)) +
    scale_y_continuous(breaks=seq(0,10,1)) +
    labs(y = "Nota dada pelo usuário",
         x = "Tamanho da temporada")
```

Falemos agora dos boxplots focando em termos de mediana, por isso desconsideraremos os pontos externos  para ter uma visão mais limpa no gráfico. Em termos de mediana  **o que foi visto no gráfico de dispersão se repete com a queda nas notas das temporadas em torno de 40 episódios**. 

* Os limites inferiores e superiores dos boxplots **(bigodes dos boxplots) mostram o aumento das nota das temporadas com mais de 40 episódios como não tão relevantes**.
    + Os boxplots destas temporadas ficam entre os limites dos boxplots das temporadas menores (Existe forte intersecção de valores).

### Séries cujas temporadas são mais curtas são mais bem avaliadas?

```{r}
episodes %>%
    filter(series_name != "Yu Yu Hakusho") %>%
    group_by(series_name) %>%
    unique() %>%
    ggplot(aes(user_rating,
               median_season_size)) +
    geom_point(alpha = 0.1, color="#A58AFF") +
    scale_y_continuous(breaks=seq(0,100,5)) +
    scale_x_continuous(breaks=seq(0,10,1)) +
        labs(x = "Nota dada pelo usuário",
             y = "Tamanho mediano da temporada")

```

Observando as **notas por tamanho mediano da temporada** vemos que a distribuição das notas se comporta semelhantemente as **notas por tamanho de temporada.**  
O efeito perceptível de focarmos nas **notas por tamanho mediano da temporada** é que a queda das notas das temporadas de tamanho 40 aparenta fica mais nítida.     

```{r}
episodes %>%
    filter(series_name != "Yu Yu Hakusho") %>%
    group_by(series_name) %>%
    unique() %>%
    ggplot(aes(median_season_size,
           user_rating,
           group=median_season_size)) +
    geom_boxplot(position = "dodge",
                 outlier.shape = NA,
                 coef = 0,
                 fill="#A58AFF",
                 width=0.5) +
    scale_x_continuous(breaks=seq(0,90,5)) +
    scale_y_continuous(breaks=seq(0,10,1)) +
        labs(y = "Nota dada pelo usuário",
         x = "Tamanho mediano da temporada")
```

O boxplot mostra resultados semelhantes aos fornecidos pela análise das **notas por tamanho de temporada.**  
    
### O tamanho da temporada afeta o consenso?

```{r}
episodes %>%
    filter(series_name != "Yu Yu Hakusho") %>%
    group_by(series_name,season) %>%
    ggplot(aes(season_size,consensus)) +
    geom_point(alpha=0.3) +
    scale_y_continuous(breaks=seq(0,1,0.1)) +
    scale_x_continuous(breaks=seq(0,100,5)) +
    labs(y = "Grau de consenso",
         x = "Tamanho da temporada")
```

**O grau de consenso das temporadas com mais de 30 episódios, em sua maior parte, permanece na faixa entre 0.2 e 0.5 de consenso** (entre 20% e 50% de consenso).  
Existe um grande dispersão em termos de grau de consenso para temporada com até 30 episódios. Isso poderia sugerir que o tamanho da temporada não é a informação adequada para explicar o consenso das temporadas nessa faixa de número de episódios.

<br></br>

### Conclusão

* O tamanho da temporada em geral não gera um efeito significativo na nota das séries. **Tamanho de temporada não condiz com temporada maior ou melhor olhando pra temporada isoladamente ou pro tamanho mediano das temporadas de uma série.** 
    + A exceção ao que foi dito antes é que existe nas notas para as temporadas (e para o  tamanho mediano das temporadas de uma série) em torno de 40 episódios uma palpável queda nas notas. 

<br></br>

* Para temporadas de até 30 episódios o tamanho da temporada não parece ser a informação adequada para explicar o grau de consenso. 
    + **Para temporadas de mais de 30 episódios o tamanho da temporada aparenta ter um efeito limitador sobre o grau de consenso**, que em geral não passa de 0.5 (50%). Temporadas muito grandes poderiam induzir qualidade irregular como por exemplo episódios filler.

***

## Os episódios que recebem mais votação são episódios mais bem avaliados?

```{r}
episodes %>% 
    ggplot(aes(user_votes,user_rating,
               size = user_votes)) +
    geom_point(alpha=.3,
               position = position_jitterdodge()) +
    scale_y_continuous(breaks=seq(0,10,1)) +
    scale_x_continuous(breaks=seq(0,1000000,15000)) +
    labs(y = "Nota dada pelo usuário",
         x = "Número de votos")

```

Existe um vísivel acréscimo no número de votos quando subimos as notas para além de 7. **Na faixa de notas entre 8 e 10 é perceptível um grande aumento no número de votos**.  

```{r}
episodes %>% 
    group_by(episode) %>%
    ggplot(aes(user_rating)) +
        geom_density(aes(y= 0.1 * ..density..),
                 color="darkblue") +
    geom_vline(xintercept = mean(episodes$user_rating), color = "darkred") + 
    geom_vline(xintercept = median(episodes$user_rating), color = "darkgreen") +
    scale_x_continuous(breaks=seq(0,10,0.5)) +
    labs(y = "Densidade de frequência",
         x = "Nota dada pelo usuário")
```

Como já foi dito anteriormente a nota 8 é um ponto de particular interesse (moda) para a distribuição das notas. A média (linha vermelha) e a mediana (linha verde) também convergem para essa nota.    
Por esse motivo **iremos comparar o consenso entre os episódios cujas notas estão abaixo de 8 (não bem_avaliado) com os que cujas notas estão acima de 8 (bem_avaliado)**.   

```{r}
episodes <- 
    episodes %>% 
    mutate(bem_avaliado = user_rating >= 8)

episodes %>% 
    select(episode,
           user_rating,
           bem_avaliado) %>%
    sample_n(10)
```

```{r}
episodes %>% 
    ggplot(aes(user_votes,bem_avaliado,
               color = bem_avaliado)) +
    geom_jitter(alpha = .8, width = 0.6) +
    scale_x_continuous(breaks=seq(0,1000000,15000)) +
            labs(x = "Número de votos")
```

Resultados semelhantes à dispersão sem distinção dos bem avaliados (número de votos por nota dada pelo usuário). É ainda mais nítida a ligação entre notas mais altas e maior número de votos. 

### Os episódios mais bem avaliados geram mais consenso?

```{r}
episodes %>% 
    ggplot(aes(consensus,bem_avaliado,
               color = bem_avaliado)) +
    geom_jitter(alpha=0.08) +
    scale_x_continuous(breaks=seq(0,1,0.1)) +
    labs(x = "Grau de consenso")

```

Curiosamente a massa de maior densidade de ocorrências (parte mais escura) dos dois grupos é relativamente próxima uma da outra, ainda assim é possível perceber que _a massa das ocorrências dos bem avaliados está mais à direita (maior grau de consenso)_.       

**Os episódios bem avalidos geram mais consenso**, ocorrências acima dos 0.5/50% são mais frequentes nos bem avaliados e em geral a massa das ocorrências dos bem avaliados está mais à direita (maior grau de consenso) do que os não bem avaliados. 

<br></br>

### Conclusão

* Existe um vísivel acréscimo no número de votos quando passamos para notas mais altas (especialmente acima de 8).
* Os episódios bem avalidos geram mais consenso.
