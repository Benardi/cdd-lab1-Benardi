---
title: "EDA Game of Thrones (GOT) and Xena the Warrior Princess"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

Analisaremos as avaliações do IMDB das séries Game of Thrones e Xena The Warrior Princess.  

## Panorama dos dados

```{r}
episodes = read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character())) %>% 
           filter(series_name %in% c("Game of Thrones","Xena a Princesa Guerreira")) %>%
           glimpse()
```

### Em geral quantos votos um episódio tem em uma temporada da série?

```{r}
episodes %>% 
    filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) +
    ggtitle("Distribuição de votação por episódios a cada temporada (Xena)")
```

A série Xena teve em geral centenas de votos para os episódios da série ao longo de suas seis temporadas.  

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    filter(season != 6) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) + 
    ggtitle("Distribuição de votação por episódios a cada temporada (GOT)")
```

A série GOT teve dezenas de milhares de votos para seus episódios ao longo de suas cinco primeiras temporadas.  

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    filter(season == 6) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) + 
    ggtitle("Distribuição de votação por episódios a cada temporada (GOT)")
```

Na sua sexta temporada GOT teve um aumento considerável de votos, chegando à escala de centena de milhar de votos.  

### Quantos episódios cada série tem por temporada?

```{r}
episodes %>% 
    ggplot(aes(season, fill=series_name))  + 
    geom_bar(position="dodge") +
    ggtitle("Número de episódios por temporada")

```

A série Xena tem entre 20 e 25 episódios por temporada enquanto GOT mantém o número de 10 episódios por temporada.  

******
## Qual das séries é mais bem avaliada no IMDB? 

```{r}
form <- function(x) c(mean = mean(x),
                      max = max(x),
                      min = min(x),
                      q1 = quantile(x, 0.25), 
                      q2 = quantile(x, 0.50),
                      q3 = quantile(x, 0.75))

epsd_summr <- 
    episodes %>% 
    subset(select=c("user_rating", "series_name")) %>%
    aggregate(user_rating ~ series_name, ., form) %>%
    do.call(data.frame, .) %>%
    setNames(c("series_name","mean","max","min","q1","q2","q3")) 

epsd_summr
```

```{r}
episodes %>% 
    ggplot(aes(x = series_name,
               y = user_rating,
               group=series_name,
               color=series_name)) +
    geom_violin() +
    geom_boxplot(width=.1) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())
```

* As notas de GOT são em geral mais altas que as de Xena, o que é refletido no gráfico pelo fato de que tanto o diagrama de caixa como o diagrama de violino vermelho (GOT) estarem acima dos diagrama de violino e caixa azuis (Xena). 

* As notas mais frequentes de  GOT estão entre [8.5, 9] (parte mais larga do violino vermelho) enquanto as notas mais frequentes de Xena estão em torno de 8.0 (parte mais larga do violino azul). 

**A série _Game of Thrones_ aparenta ser  mais bem avaliada do que a série _Xena a Princesa Guerreira_ no IMBD**.  

```{r}
form <- function(x) c(mean = mean(x), sd = sd(x), n =length(x))

episodes %>% 
    aggregate(user_rating ~ series_name, ., form) %>%
    do.call(data.frame, .) %>%
    mutate(se = user_rating.sd/sqrt(user_rating.n)) %>%
    setNames(c("series_name","mean","sd","n","se")) %>% 
    ggplot(aes(series_name,mean, fill = series_name)) + 
    geom_bar(stat='identity') + 
    geom_errorbar(aes(width= 0.25,
                      ymax = mean + se,
                      ymin = mean - se)) +
    scale_fill_discrete(name = "Série") + 
    scale_y_continuous(limits = c(0,10)) +
    labs(y = "mean user_rating")
```

* Pela altura das barras (média das notas) é observável que a média da nota de GOT é mais alta do que a média das notas de Xena.

A média das notas também sugere que a série _Game of Thrones_ **é mais bem avaliada** que a série _Xena the Warrior Princess_ no IMBD, a diferença aparenta ser de 1 ponto e em termos de notas de séries essa **diferença é grande**.  

******
###  Muda de acordo com as temporadas da série?

```{r}
episodes %>% 
  ggplot(aes(x = series_name, y = user_rating, fill=season)) +
    geom_boxplot(position = position_dodge(width = 0.9)) 
```

A _nota mediana/barra central da caixa_ **valor que dividide os outros valores em 50% menores e 50% maiores** e o _intervalo interquatil/caixa_ **que representa 50% dos valores** flutuam ao longo das temporadas mas aparentam permanecer relativamente próximos da nota 9 para GOT e próximos de 8 para Xena.  

Quando comparamos a distribuição das notas  ao longo das temporadas percebemos que **as notas são afetadas pela mudança de temporada** (e.g. as notas da série Xena refletem uma tendência de queda a partir da 4ª temporada em diante, mínimos indo de 7 para 6).  

```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating,
             color=series_name)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())
```

Comparando a distribuição das notas das avaliações de cada série por temporada (notas da 1ª temporada de GOT com as notas da 1ª temporada de Xena) é possível notar que ao longo de todas as seis temporadas foi mantida uma mesma tendência. Observando a distribuição das notas através do intervalo interquatil/caixa, é possível notar que **em todas as seis temporadas GOT permanece com notas mais altas do que Xena** (A caixa de GOT está sempre acima da caixa de Xena).  

<br></br>

As notas das séries variam com a temporada mas para efeito de comparação, de uma série com outra, mantém-se uma nota maior de GOT em relação a Xena.  

******
## Qual das séries tem episódios de qualidade mais irregular segundo o IMDB?

```{r}
episodes %>% 
  ggplot(aes(x = series_name, y = user_rating)) + 
    geom_jitter(width = 0.25) 
```

* As notas de GOT vão de **8 (mínimo) até 9.9 (máximo)** e aparentam estar relativamente concentradas em torno de 9, o que está em acordo com resultados anteriores.

* As notas de Xena vão de **5.9 (mínimo) até 8.8 (máximo)** e aparentam estar relativamente concentradas em torno de 8, o que está em acordo com resultados anteriores.

**A série Xena aparenta ter notas mais irregulares do que GOT** estando dispersa em um intervalo maior [5.9, 8.8] do que GOT [8, 9.9].

```{r}
episodes %>%
  ggplot(aes(user_rating,color=series_name)) +
    geom_density()
```

O histograma alisado reforça a ideia de que **a série Xena tem notas mais irregulares do que GOT** pois as notas de Xena ocorrem ao longo do intervalo [5.9, 8.8] (começo e fim do histograma azul) enquanto as notas de GOT ocorrem ao longo do intervalo [8, 9.9](começo e fim do histograma vermelho). Além disso o pico do histograma alisado (moda ou valor mais frequente) é em torno de 8 para Xena e em torno de 9 para GOT.

```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating,
             color=series_name)) +
    geom_jitter(width = 0.25) +
    facet_wrap(~ season) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())
```

```{r}
episodes %>%
  ggplot(aes(user_rating,color=series_name)) +
    geom_density() +
    facet_wrap(~ season)
```

Olhando o diagrama de caixa e o histograma alisado das  séries ao longo de temporadas é possível perceber que as notas da série Xena ficaram mais dispersas a partir da temporada 4 em diante pois passam a existir pontos desde em torno de 6 (pontos do gráfico ficam mais separados e histograma fica mais comprido).   

**As notas da série Xena são mais irregulares do que as notas de GOT e a diferença é grande**, com as notas de Xena indo de 6 até 9 enquanto as notas de GOT vão de 8 até 10.   

******

## Qual das séries tem episódios mais sem graça? (Um episódio é sem graça se ninguém nem ama nem odeia ele)

```{r}
episodes <- episodes %>%
    mutate(
        rank_odiados = row_number(r1), # maior = mais odiado
        rank_amados = row_number(r10), # maior = mais amado
        amado_odiado = rank_amados * rank_odiados) # maior = mais amado E odiado 

episodes %>% 
    ggplot(aes(x = series_name,
               y = amado_odiado,
               group=series_name,
               color=series_name)) +
    geom_jitter() +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())

```

A série Xena apresenta uma grande concentração de episódios que não foram nem amados nem odiados, amado_odiado perto de 0, como mostra claramente o gráfico de dispersão, enquanto a série GOT não possui episódios cujo valor amado_odiado esteja perto de 0. **Portanto a série Xena é a série com mais episódios sem graça.**

******

## Episódios no início/fim da temporada são mais bem avaliados que os no meio?

Consideraremos os 20% iniciais e os 20% finais como o começo e fim de temporada, e os 60% entre essas duas parcelas como o meio de temporada. Um episódio será de metade de temporada se estiver incluido nesses 60%.

```{r}
form <- function(x) c(mean = mean(x),
                      max = max(x),
                      min = min(x),
                      n =length(x))

epsd_summr <- 
    episodes %>% 
    subset(select=c("season_ep",
                    "season",
                    "series_name")) %>%
    aggregate(season_ep ~ series_name+season, ., form) %>%
    do.call(data.frame, .) %>%
    setNames(c("series_name",
               "season","mean",
               "max","min","n")) %>%
    rowwise() %>%
    mutate(p20 = quantile(seq(from=1, to=n, by=1), 0.20), ## Separa os 20% iniciais
           p80 = quantile(seq(from=1, to=n, by=1), 0.80)) ## Separa os 20% finais

episodes <- merge(episodes, epsd_summr) %>% 
    rowwise() %>%
    mutate(middle_eps = (season_ep > p20) & ## Classifica em metade da série ou não
               (season_ep < p80)) 
episodes %>%
    subset(select=c("series_name",
                    "season_ep",
                    "p20","p80",
                    "middle_eps"))
```

<br></br>

Geramos a informação **_middle_eps_** para representar se uma série é ou não do meio da temporada, está entre os 20% episódios inicias e finais da temporada (no meio). Se **_middle_eps_** é TRUE o episódio é da metade da temporada, se **_middle_eps_** é FALSE o episódio é do começo/fim da temporada.  

```{r}

filtered <- episodes %>%
    filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
    filter(season == 4)

filtered %>%
    ggplot(aes(x = season_ep, y = user_rating, color = series_name)) +
    geom_vline(xintercept = filtered$p20,
    color = "blue") +
    geom_vline(xintercept = filtered$p80,
    color = "blue") +
    geom_line()
```

Usando a 4ª temporada da série Xena como exemplo os episódios da metade de temporada seriam aqueles entre as barras azuis (20º percentil e 80º percentil, os quais dividem os valores em 20%-80% e 80%-20% respectivamente e assim o que está entre eles é 60% do total).

```{r}
episodes %>% 
  ggplot(aes(user_rating, color=middle_eps)) + 
    geom_density()
```

As formas dos histogramas alisados são semelhantes, e o pico de ambos (moda ou valor mais frequente) coincide na nota 8, isso sugere que **sem distinguir as séries umas das outras os episódios no início/fim da temporada são avaliados semelhantemente aos que estão no meio da série**.  

### Muda de acordo com série?

```{r}
episodes %>% 
  ggplot(aes(x = series_name, y = user_rating, color=middle_eps)) + 
    geom_point(position = position_jitterdodge(dodge.width=0.9)) +
    geom_boxplot(position = "dodge") 

```

Distiguindo as séries é possível notar que os boxplots azuis (que representam os episódios da metade da temporada) estão em geral abaixo dos boxplots vermelhos (que representam os episódios do começo/fim) da temporada. **Assim, em termos de séries os episódios do começo/fim de temporada são mais bem avaliados.**  

### Muda de acordo com temporada?

```{r}
episodes %>% 
  filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
  ggplot(aes(x = middle_eps,
             y = user_rating,
             color = middle_eps)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    ggtitle("Distribuição de votação metade da temporada versus começo/fim (Xena)")
```

Para  a série Xena: 

* Nas temporadas 5 e 6 os episódios de começo/fim de temporada foram mais bem votados

* Na temporada 1,2,3 e 4 a diferença fica menos clara.  

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    ggplot(aes(x = middle_eps,
             y = user_rating,
             color = middle_eps)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    ggtitle("Distribuição de votação metada da temporada versus começo/fim (GOT)")

```

Para a série GOT:
 
* Na 5ª temporada episodios do começo/fim e metade se comportam de maneira similar

* Nas temporadas 1,2,3,4 e 6  os episódios de começo/fim (boxplots vermelhos) são mais bem avaliados.

Levando em consideração o que foi visto tanto em Xena como em GOT **em termos de temporada os episódios começo/fim tendem a ser mais bem avaliados que os episódios de metade de temporada**.

