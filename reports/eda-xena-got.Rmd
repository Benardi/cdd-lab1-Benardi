---
title: "Chakrans and Dragons on IMDB"
subtitle: "EDA on IMDB data about Game of Thrones (GOT) and Xena the Warrior Princess"
author: "José Benardi de Souza Nunes"
output:
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

*******

## Employed data

Exploratory data analysis on [IMDB](https://www.imdb.com/) data about TV series.
Original data comes from [this repository](https://github.com/nazareno/imdb-series), there we have an explanation on how the data was gathered and the meaning of each variable.

## Data under analysis

Before the staggering number of different series available in our data we will analyse the following two:

* Game of Thrones 
* Xena The Warrior Princess (in portuguese _Xena a Princesa Guerreira_)

*******

## Data Overview 

```{r}
episodes = read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character())) %>% 
           filter(series_name %in% c("Game of Thrones","Xena a Princesa Guerreira")) 

episodes %>%
           glimpse()
```

### On average how many votes there are for an episode of a season?

```{r}
episodes %>% 
    filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) +
    labs(x="Season episode",
         y= "Number of votes",
         title="Distribution of votes per episode throughout seasons (Xena)")
```

The series Xena overall had hundreds of votes for each episode throughout its six seasons.

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    filter(season != 6) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) + 
        labs(x="Season episode",
         y= "Number of votes",
         title="Distribution of votes per episode throughout seasons (GOT)")
```

The series GOT had tenths of thousands of votes for each episode throughout its first five seasons.
Furthermore, there are some episodes with a lot more votes than the rest.

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    filter(season == 6) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) + 
    labs(x="Season episode",
         y= "Number of votes",
         title="Distribution of votes per episode throughout seasons (GOT)")
```

On its sixth season GOT had a considerable increase in votes, reaching figures on the scale of hundreds of thousands of votes.

### Hom many episodes per season?

```{r}
episodes %>% 
    ggplot(aes(season, fill=series_name))  + 
    geom_bar(position="dodge") +
    ggtitle("Número de episódios por temporada") +
    labs(x="Season", y="Number of episodes",
         title="Number of episodes per season")
```

The series Xena has around 20 to 25 episodes per season while GOT maintains the number of 10 episodes per season. 

******

## Which of the series is better rated on IMDB?

```{r}
sumario_simples <- episodes %>%
    select(user_rating, series_name) %>%
    group_by(series_name) %>%
    summarise(
        mean = mean(user_rating),
        max = max(user_rating),
        min = min(user_rating),
        q1 = quantile(user_rating, 0.25),
        q2 = quantile(user_rating, 0.50),
        q3 = quantile(user_rating, 0.75)
    ) 

sumario_simples

```

```{r}
episodes %>% 
    ggplot(aes(x = series_name,
               y = user_rating,
               group=series_name,
               color=series_name)) +
    geom_violin() +
    geom_boxplot(width=.1) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    labs(y="User rating")
```
* GOT rating overall are higher than Xena's, this is reflected in the chart where both the red violin plot and box plot (GOT) are above the red violin plot and box plot (Xena).
* The most frequent ratings  for GOT are around [8.5, 9] (lengthiest part of the red violin) while the most frequent ratings for Xena are around 8.0 (lengthiest part of the blue violin). 

** The series _Game of Thrones_ seems to be better rated than the series _Xena a Princesa Guerreira_ no IMBD**.  

```{r}
episodes %>% 
    group_by(series_name) %>%
    summarise(
        mean = mean(user_rating),
        sd = sd(user_rating),
        n = n()
    ) %>%
    mutate(se = sd/sqrt(n)) %>%
    ggplot(aes(series_name,mean, fill = series_name)) +
    geom_bar(stat='identity') +
    geom_errorbar(aes(width= 0.25,
                      ymax = mean + se,
                      ymin = mean - se)) +
    scale_fill_discrete(name = "Series name") +
    scale_y_continuous(limits = c(0,10)) +
    labs(y = "Mean user rating") +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())
```

* Looking at the height of the bars (Mean user rating) it's noticeble that GOT's mean user rating is higher than Xena's mean user rating.

The mean user rating also suggests that the series _Game of Thrones_ **é mais bem avaliada** is better rated than the series _Xena the Warrior Princess_ on IMBD,  the difference seems to be of 1 point and in terms of series ratings **the difference is sizable**.

******

### Does it change according to the series season?

```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating, 
             fill=as.numeric(season))) +
    geom_boxplot(position = position_dodge(width = 0.9)) +
    labs(x="Series name", y="User rating")
```

The _median rating/box's central horizontal line_ **value that divides other values in 50% bigger and 50% smaller**  and the _interquatile range/box_ **that represents 50% of the values** fluctuate thoughout the series seasons but seem to stay relatively close to the rating 9 for GOT and close to 8 for Xena.

When we compare the distribution of ratings thoughout the series seasons we notice that **the ratings are affected by what season they belong to** (e.g Xena's ratings show a negative tendency starting from season 4, minimums going from 7 to 6).

```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating,
             color=series_name)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    ylab("User rating")
```

Comparing the distribution of each series ratings throughout each seasons (ratings from GOT's first season compared to ratings from Xena's first season) we observe that at each of the six seasons the same tendency was mantained. Observing the ratings distribution by means of the interquatile range/box we notice that **On all six seasons  GOT has overall higher ratings than Xena** (GOT's interquatile range is always above Xena's).

<br></br>

The series' ratings vary with the seasons but for comparison purposes GOT maintains a higher rating than Xena.

******
## Which series is the one whose episodes' quality is the most irregular?

```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating)) + 
    geom_jitter(width = 0.25) +
    labs(x="Series name", 
         y="User rating")
```

* GOT ratings go from **8 (minimum) to 9.9 (maximum)** and seem to be relatively concentrated around 9, which is in accordance to previous results.

* Xena's ratings go from **5.9 (minimum) to 8.8 (maximum)** and seem to be relatively concentrated around 8, which is in accordance to previous results.

**The series Xena's ratings seem to be more irregular than GOT's ratings** as they are disperse in a bigger interval [5.9, 8.8] than GOT's [8, 9.9].

```{r}
episodes %>%
  ggplot(aes(user_rating,color=series_name)) +
    geom_density() +
    labs(x="User rating",
         y="Density")
```

The smoothed histogram reinforces the idea that **Xena's ratings are more irregular than GOT's** because Xena'ss rating are dispersed around the interval [5.9, 8.8] (beginning and end of blue histogram) while GOT's ratings are dispersed around the interval [8, 9.9] (beggining and end of red histogram). Besides, the smoothed histogram's peak (mode or most frequent value) is around 8 for Xena and around 9 for GOT.

```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating,
             color=series_name)) +
    geom_jitter(width = 0.25) +
    facet_wrap(~ season) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    labs(x="User rating")
```

```{r}
episodes %>%
  ggplot(aes(user_rating,
             color=series_name)) +
    geom_density() +
    facet_wrap(~ season) +
    labs(x="User rating",
         y="Density")
```

Looking at the scatter plot and smoothed histogram of the series seasons it's possible to see that Xena's rating got more disperse starting from season 4 because points around 6 start to occur (distance between points increase and histograms stretch).

** Xena's rating are more irregular than GOT's ratings and the difference is big**, with Xena's rating going from 6 to 9 while GOT's ratings go from 8 to 10.

******

## Qual das séries tem episódios mais sem graça? (Um episódio é sem graça se ninguém nem ama nem odeia ele)

```{r}
episodes <- episodes %>%
    mutate(
        rank_odiados = row_number(r1), # maior = mais odiado
        rank_amados = row_number(r10), # maior = mais amado
        amado_odiado = rank_amados * rank_odiados) # maior = mais amado E odiado 

episodes %>% 
    ggplot(aes(x = series_name,
               y = amado_odiado,
               group=series_name,
               color=series_name)) +
    geom_jitter() +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())

```

A série Xena apresenta uma grande concentração de episódios que não foram nem amados nem odiados, amado_odiado perto de 0, como mostra claramente o gráfico de dispersão, enquanto a série GOT não possui episódios cujo valor amado_odiado esteja perto de 0. **Portanto a série Xena é a série com mais episódios sem graça.**

******

## Episódios no início/fim da temporada são mais bem avaliados que os no meio?

Consideraremos os 20% iniciais e os 20% finais como o começo e fim de temporada, e os 60% entre essas duas parcelas como o meio de temporada. Um episódio será de metade de temporada se estiver incluido nesses 60%.

```{r}



sumario_simples <- 
    episodes %>% 
    select(season_ep,season,series_name) %>%
    group_by(series_name,season) %>% 
    summarise(n = n(),
               p20 = quantile(seq(from=1, to=n, by=1), 0.20),
               p80 = quantile(seq(from=1, to=n, by=1), 0.80))

sumario_simples
```

```{r}
episodes <- left_join(episodes, sumario_simples,
                      by = c("series_name", "season")) %>% 
    group_by(series_name, season) %>%
    mutate(middle_eps = (season_ep > p20) &
               (season_ep < p80)) %>% 
    ungroup()
episodes
```

<br></br>

Geramos a informação **_middle_eps_** para representar se uma série é ou não do meio da temporada, está entre os 20% episódios inicias e finais da temporada (no meio). Se **_middle_eps_** é TRUE o episódio é da metade da temporada, se **_middle_eps_** é FALSE o episódio é do começo/fim da temporada.  

```{r}

filtered <- episodes %>%
    filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
    filter(season == 4)

filtered %>%
    ggplot(aes(x = season_ep, y = user_rating, color = series_name)) +
    geom_vline(xintercept = filtered$p20,
    color = "blue") +
    geom_vline(xintercept = filtered$p80,
    color = "blue") +
    geom_line()
```

Usando a 4ª temporada da série Xena como exemplo os episódios da metade de temporada seriam aqueles entre as barras azuis (20º percentil e 80º percentil, os quais dividem os valores em 20%-80% e 80%-20% respectivamente e assim o que está entre eles é 60% do total).

```{r}
episodes %>% 
  ggplot(aes(user_rating, color=middle_eps)) + 
    geom_density()
```

As formas dos histogramas alisados são semelhantes, e o pico de ambos (moda ou valor mais frequente) coincide na nota 8, isso sugere que **sem distinguir as séries umas das outras os episódios no início/fim da temporada são avaliados semelhantemente aos que estão no meio da série**.  

### Muda de acordo com série?

```{r}
episodes %>% 
  ggplot(aes(x = series_name, y = user_rating, color=middle_eps)) + 
    geom_point(position = position_jitterdodge(dodge.width=0.9)) +
    geom_boxplot(position = "dodge") 

```

Distiguindo as séries é possível notar que os boxplots azuis (que representam os episódios da metade da temporada) estão em geral abaixo dos boxplots vermelhos (que representam os episódios do começo/fim) da temporada. **Assim, em termos de séries os episódios do começo/fim de temporada são mais bem avaliados.**  

### Muda de acordo com temporada?

```{r}
episodes %>% 
  filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
  ggplot(aes(x = middle_eps,
             y = user_rating,
             color = middle_eps)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    ggtitle("Distribuição de votação metade da temporada versus começo/fim (Xena)")
```

Para  a série Xena: 

* Nas temporadas 5 e 6 os episódios de começo/fim de temporada foram mais bem votados

* Na temporada 1,2,3 e 4 a diferença fica menos clara.  

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    ggplot(aes(x = middle_eps,
             y = user_rating,
             color = middle_eps)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    ggtitle("Distribuição de votação metada da temporada versus começo/fim (GOT)")

```

Para a série GOT:
 
* Na 5ª temporada episodios do começo/fim e metade se comportam de maneira similar

* Nas temporadas 1,2,3,4 e 6  os episódios de começo/fim (boxplots vermelhos) são mais bem avaliados.

Levando em consideração o que foi visto tanto em Xena como em GOT **em termos de temporada os episódios começo/fim tendem a ser mais bem avaliados que os episódios de metade de temporada**.
