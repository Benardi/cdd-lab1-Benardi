---
title: "EDA Game of Thrones (GOT) and Xena the Warrior Princess"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

Analisaremos as avaliações do IMDB das séries Game of Thrones e Xena The Warrior Princess.  

## Panorama dos dados

```{r}
episodes = read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character())) %>% 
           filter(series_name %in% c("Game of Thrones","Xena a Princesa Guerreira")) %>%
           glimpse()
```

### Em geral quantos votos um episódio tem em uma temporada da série?

```{r}
episodes %>% 
    filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) +
    ggtitle("Distribuição de votação por episódios a cada temporada (Xena)")
```

A série Xena teve em geral centenas de votos para os episódios da série ao longo de suas seis temporadas.  

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    filter(season != 6) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) + 
    ggtitle("Distribuição de votação por episódios a cada temporada (GOT)")
```

A série GOT teve dezenas de milhares de votos para seus episódios ao longo de suas cinco primeiras temporadas.  

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    filter(season == 6) %>%
    ggplot(aes(x = season_ep, y = user_votes))  + 
    geom_line() +
    facet_wrap(~ season) + 
    ggtitle("Distribuição de votação por episódios a cada temporada (GOT)")
```

Na sua sexta temporada GOT teve um aumento considerável de votos, chegando à escala de centena de milhar de votos.  

### Quantos episódios cada série tem por temporada?

```{r}
episodes %>% 
    ggplot(aes(season, fill=series_name))  + 
    geom_bar(position="dodge") +
    ggtitle("Número de episódios por temporada")

```

A série Xena tem entre 20 e 25 episódios por temporada enquanto GOT mantém o número de 10 episódios por temporada.  

******
## Qual das séries é mais bem avaliada no IMDB? 

```{r}
form <- function(x) c(mean = mean(x),
                      max = max(x),
                      min = min(x),
                      q1 = quantile(x, 0.25), 
                      q2 = quantile(x, 0.50),
                      q3 = quantile(x, 0.75))

epsd_summr <- 
    episodes %>% 
    subset(select=c("user_rating", "series_name")) %>%
    aggregate(user_rating ~ series_name, ., form) %>%
    do.call(data.frame, .) %>%
    setNames(c("series_name","mean","max","min","q1","q2","q3")) 

epsd_summr
```

```{r}
episodes %>% 
    ggplot(aes(x = series_name,
               y = user_rating,
               group=series_name,
               color=series_name)) +
    geom_violin() +
    geom_boxplot(width=.1) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())
```
*  Em especial em termos de mediana GOT está bem acima com seus 8.95 contra os 7.80 de Xena.
* É possível notar que a quase totalidade das notas de GOT (min = 8.0) está pelo menos muito próxima do terceiro quartil de Xena (8.5). 
* É possível perceber que a densidade de frequência (violin-plot) das notas de GOT é  mais alta em torno de entre [8.5, 9] enquanto que a densidade de frequência das notas de Xena é mais alta entre ao redor de 8.0. 

Em termos de quartis e de densidade de frequência **a série _Game of Thrones_ aparenta ser  mais bem avaliada do que a série _Xena a Princesa Guerreira_ no IMBD**.  

```{r}
form <- function(x) c(mean = mean(x), sd = sd(x), n =length(x))

episodes %>% 
    aggregate(user_rating ~ series_name, ., form) %>%
    do.call(data.frame, .) %>%
    mutate(se = user_rating.sd/sqrt(user_rating.n)) %>%
    setNames(c("series_name","mean","sd","n","se")) %>% 
    ggplot(aes(series_name,mean, fill = series_name)) + 
    geom_bar(stat='identity') + 
    geom_errorbar(aes(width= 0.25,
                      ymax = mean + se,
                      ymin = mean - se)) +
    scale_fill_discrete(name = "Série") + 
    scale_y_continuous(limits = c(0,10)) +
    labs(y = "mean user_rating")
```

* Comparando a avalição média dos usúarios para Game of Thrones (9.046667) com a avaliação média de Xena (7.715672), Game of Thrones sai mais uma vez como a mais bem avaliada.

* Observando as barras de erro (erro padrão da média), de pequeno intervalo e  suficientemente distantes uma da outra, estas não aparentam minorar o que os valores médios apontam.   

Tanto os valores médios como o gráfico de barras incluindo as barras de erro (médio em sua barra de erro (erro padrão) reforçam a afirmação de que **a série _Game of Thrones_ é mais bem avaliada que a série _Xena the Warrior Princess_ no IMBD**.  

******
###  Muda de acordo com as temporadas da série?

```{r}
episodes %>% 
  ggplot(aes(x = series_name, y = user_rating, fill=season)) +
    geom_boxplot(position = position_dodge(width = 0.9)) 
```
* Em relação à distribuição das notas das avaliações de Game of Thrones ao longo de seis temporadas
    + É visível que temporada 6 e 4 apresentam uma maior variabilidade do que em outras temporadas.  
    + A temporada 4 tem uma concentração de notas mais altas que o resto das outras temporadas.  
    + A avaliação mediana e o intervalo interquatil flutuam ao longo das temporadas mas aparentam permanecer relativamente próximos da nota 9 (Aparenta ser menos verdade pra temporada 4 e 5 ).   
    
<br></br>

* Em relação à distribuição das notas das avaliações de Xena ao longo de seis temporadas
    + A partir da 4ª temporada em diante notas mais baixas surgem afetando o limite inferior dos boxplots. 
    + A avaliação mediana e o intervalo interquatil flutuam ao longo das temporadas mas aparentam permanecer relativamente próximos da nota 8 (O que parece ser mais verdade para a mediana do que para o intervalo interquartil). 

Quando comparamos a distribuição das notas das avaliações das temporadas dentro de uma mesma série percebemos que **o perfil das notas das avaliações muda de acordo com as temporadas da série** (e.g. as notas da série Xena refletem uma tendência de queda a partir da 4ª temporada em diante quando comparadas com a 3ª temporada).  
```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating,
             color=series_name)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())
```

Comparando a distribuição das notas das avaliações de cada série por temporada (avaliações de GOT na temporada 1 contra Xena temporada 1) é possível notar que ao longo de todas as seis temporadas foi mantida uma mesma tendência. Em termos não só de intervalo interquatil mas também virtualmente em 100% da distribuição das notas, **em todas as seis temporadas GOT permanece com notas mais altas do que Xena**.

******
## Qual das séries tem episódios de qualidade mais irregular segundo o IMDB?

```{r}
episodes %>% 
  ggplot(aes(x = series_name, y = user_rating)) + 
    geom_jitter(width = 0.25) 
```

* As notas das avaliações de GOT ocorrem desde 8 (mínimo) até 9.9 (máximo) e aparentam estar relativamente concentradas em torno de 9, o que está em acordo com resultados anteriores.

* As notas das avaliações de Xena ocorrem desde 5.9 (mínimo) até 8.8 (máximo) e aparentam estar relativamente concentradas em torno de 8, o que está em acordo com resultados anteriores.

**A série Xena aparenta ter notas mais irregulares do que GOT** estando dispersa em um intervalo maior [5.9, 8.8] do que GOT [8, 9.9].

```{r}
episodes %>%
  ggplot(aes(user_rating,color=series_name)) +
    geom_density()
```

O histograma alisado reforça a ideia de que **a série Xena tem notas mais irregulares do que GOT** pois as notas de Xena ocorrem ao longo do intervalo [5.9, 8.8] (limites  do histograma azul) enquanto as notas de GOT ocorrem ao longo do intervalo [8, 9.9](limites do histograma vermelho). Sendo a amplitude do primeiro intervalo maior do que a do segundo. Mas, além disso o histograma alisado também demonstra que de fato os ponto de maior densidade de frequência das notas é em torno de 8 para Xena e em torno de 9 para GOT.

```{r}
episodes %>% 
  ggplot(aes(x = series_name,
             y = user_rating,
             color=series_name)) +
    geom_jitter(width = 0.25) +
    facet_wrap(~ season) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())
```

```{r}
episodes %>%
  ggplot(aes(user_rating,color=series_name)) +
    geom_density() +
    facet_wrap(~ season)
```

Avaliando a dispersão e a densidade de frequência das notas de ambas séries por temporadas é possível perceber que a dispersão das notas da série Xena aumentou sensivelmente a partir da temporada 4 em diante (passam a existir ocorrências desde em torno de 6). Esta observação está em acordo com resultados anteriores e os valores destas três temporadas são os prováveis responsavéis que tornam **as notas da série Xena mais irregulares do que as notas de GOT.**  

## Episódios no início/fim da temporada são mais bem avaliados que os no meio?

Consideraremos os 20% iniciais e os 20% finais como o começo e fim de temporada, e os 60% entre essas duas parcelas como o meio de temporada. O período será considerado melhor avaliado se tiver o episódio de maior pontuação, caso haja empate será o que tiver valores mais altos mais frequentemente.   

```{r}
form <- function(x) c(mean = mean(x),
                      max = max(x),
                      min = min(x),
                      n =length(x))
                

epsd_summr <- 
    episodes %>% 
    subset(select=c("season_ep", "season","series_name")) %>%
    aggregate(season_ep ~ series_name+season, ., form) %>%
    do.call(data.frame, .) %>%
    setNames(c("series_name","season","mean","max","min","n")) %>%
    rowwise() %>%
    mutate(p20 = quantile(seq(from=1, to=n, by=1), 0.20)) %>%
    mutate(p80 = quantile(seq(from=1, to=n, by=1), 0.80))

epsd_summr
```

```{r}
episodes <- merge(episodes, epsd_summr) %>% 
    rowwise() %>%
    mutate(middle_eps = (season_ep > p20) &
               (season_ep < p80)) 
episodes
```


```{r}
episodes %>% 
  ggplot(aes(x = middle_eps, y = user_rating)) + 
    geom_jitter(width = 0.25) 
```

```{r}
filtered <- episodes %>%
    filter(series_name %in% c("Xena a Princesa Guerreira"))

filtered %>%
    ggplot(aes(x = season_ep, y = user_rating, color = series_name)) +
    geom_vline(xintercept = quantile(filtered$season_ep, 0.2),
    color = "blue") +
    geom_vline(xintercept = quantile(filtered$season_ep, 0.8),
    color = "blue") +
    geom_line() + facet_wrap(~ season)
```
* Temporada 1: Maior rating foi no meio da temporada
* Temporada 2: Maior rating foi no meio da temporada
* Temporada 3: Maior rating foi no meio da temporada
* Temporada 4: Maior rating foi no fim da temporada
* Temporada 5: Maior rating foi no fim da temporada
* Temporada 6: Maior rating foi no começo da temporada

Para Xena 50% das temporadas tiveram seu melhor rating no meio da temporada e 50% tiveram seu melhor rating no começo/fim da temporada.

```{r}
episodes %>% 
  filter(series_name %in% c("Xena a Princesa Guerreira")) %>%
  ggplot(aes(x = middle_eps,
             y = user_rating,
             color = middle_eps)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    ggtitle("Distribuição de votação metada da temporada versus começo/fim (Xena)")
```


```{r}

filtered <- episodes %>%
    filter(series_name %in% c("Game of Thrones"))

filtered %>%
    ggplot(aes(x = season_ep, y = user_rating, color = series_name)) +
    geom_vline(xintercept = quantile(filtered$season_ep, 0.2),
    color = "blue") +
    geom_vline(xintercept = quantile(filtered$season_ep, 0.80),
    color = "blue") +
    geom_line() + facet_wrap(~ season)
```

* Temporada 1: Maior rating foi no fim da temporada
* Temporada 2: Maior rating foi no fim da temporada
* Temporada 3: Maior rating foi no fim da temporada
* Temporada 4: Maior rating foi no fim da temporada 
    + (Rating de nível ocorreu duas vezes próximo do começo/fim e meio da temporada representou caída)
* Temporada 5: Maior rating foi no fim da temporada
* Temporada 6: Maior rating foi no fim da temporada

Para GOT 100% das temporadas tiveram seu melhor rating no começo/fim da temporada.

**Os períodos de melhor rating ficaram divididos para a série Xena e foram claramente o começo/fim da série para GOT.** 

```{r}
episodes %>% 
    filter(series_name %in% c("Game of Thrones")) %>%
    ggplot(aes(x = middle_eps,
             y = user_rating,
             color = middle_eps)) + 
    facet_wrap(~ season) + 
    geom_boxplot(position = position_dodge(width = 0.9)) +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank()) +
    ggtitle("Distribuição de votação metada da temporada versus começo/fim (Xena)")

```


******

## Qual das séries ou tem episódios mais sem graça? (Um episódio é sem graça se ninguém nem ama nem odeia ele)

```{r}
episodes = episodes %>%
    mutate(
        rank_odiados = row_number(r1), # maior = mais odiado
        rank_amados = row_number(r10), # maior = mais amado
        amado_odiado = rank_amados * rank_odiados) # maior = mais amado E odiado 

episodes %>% 
    ggplot(aes(x = series_name,
               y = amado_odiado,
               group=series_name,
               color=series_name)) +
    geom_jitter() +
    theme(axis.title.x=element_blank(),
          axis.text.x=element_blank(),
          axis.ticks.x=element_blank())

```

A série Xena apresenta uma grande concentração de episódios que não foram nem amados nem odiados, amado_odiado perto de 0, como mostra claramente o gráfico de dispersão, enquanto a série GOT não possui episódios cujo valor amado_odiado esteja perto de 0. **Portanto a série Xena é a série com mais episódios sem graça.**
